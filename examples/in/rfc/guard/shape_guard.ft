type MutationArg = Shape

is (m MutationArg) Input(input Shape) {
  // Note how we can use the `input` variable in the type guard below
  // which actually inserts a **type** into the shape (not a value)
  return m is { input }
}

is (m MutationArg) Context(ctx Shape) {
  return m is { ctx }
}

type AppContext = {
  sessionId: *String
}

type AppMutation = MutationArg.Context(AppContext)

is (ctx AppContext) LoggedIn() {
  return ctx.sessionId is NotNil()
}

func createUser(op AppMutation.Input({
  input: {
    name: String
  }
})) {
  ensure op.ctx is LoggedIn() or NotLoggedIn()

  println(op.ctx.sessionId)

  return op.input.name
}
